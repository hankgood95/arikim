
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ê¹€ì•„ë¦¬ì˜ ë…¸ë€ í•˜ë£¨ Â· v17.8</title>
  <style>
    :root{ --bg:#fff9cc; --text:#333; --accent:#ffd60a; --accent-dark:#ffca3a; --box:#fff; }
    body.dark{ --bg:#1e1e1e; --text:#f1f1f1; --accent:#ffca3a; --accent-dark:#ffd60a; --box:#2b2b2b; }
    *{box-sizing:border-box}
    body{margin:0; font-family:"Noto Sans KR",sans-serif; background:var(--bg); color:var(--text); transition:.25s}
    header{position:relative; text-align:center; background:var(--accent); color:#5a4e00; padding:30px}
    #darkToggle{position:absolute; right:18px; top:18px; background:none; border:none; font-size:22px; cursor:pointer}
    nav{display:flex; justify-content:center; gap:8px; flex-wrap:wrap; background:var(--box); padding:10px}
    nav button{background:var(--accent); border:none; border-radius:999px; padding:8px 14px; color:#5a4e00; font-weight:700; cursor:pointer}
    nav button:hover{background:var(--accent-dark)}
    main{max-width:1000px; margin:28px auto; padding:0 14px}

    /* í™ˆ */
    .home-grid{display:grid; grid-template-columns: 3fr 7fr; gap:16px}
    .card{background:var(--box); border:1px solid #e8e8e8; border-radius:14px; padding:16px}
    .intro-img{width:160px; height:160px; object-fit:cover; border-radius:12px; border:1px solid #ddd}
    .intro-wrap{display:flex; gap:16px; align-items:center}
    .intro-text{font-size:14px; line-height:1.6}
    .right-grid{display:grid; grid-template-rows: 1fr 1fr; gap:16px; min-height:340px}
    .pinned-list .item{font-size:14px; padding:8px 10px; border-radius:10px; border:1px solid #eee; margin-bottom:8px; cursor:pointer; background:var(--box)}
    .pinned-list .item:hover{background:var(--accent-dark); color:#5a4e00}
    .gallery{display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:10px}
    .tile{border:1px solid #ddd; border-radius:10px; overflow:hidden; background:#fff; cursor:pointer}
    .tile img{display:block; width:100%; height:100px; object-fit:cover}
    .tile .cap{padding:6px 8px; font-size:12px; color:#555; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}

    /* ëª©ë¡/ë³´ê¸° */
    .post-item{cursor:pointer; padding:12px; border-bottom:1px solid #eaeaea; border-radius:8px; background:var(--box)}
    .post-item:hover{background:var(--accent-dark); color:#5a4e00}
    .preview{max-width:360px; border:1px solid #ddd; border-radius:10px}
    .like-btn{cursor:pointer; font-size:18px; background:none; border:none}
    .like-btn.active{color:red}
    .sort-box{text-align:right; margin:10px 0}
    textarea,input,select{width:100%; max-width:720px; padding:10px; border-radius:10px; border:1px solid #cfcfcf; background:var(--box); color:var(--text)}
    .date-text{font-size:13px; color:#777}
    .btn{background:var(--accent); color:#5a4e00; border:none; border-radius:10px; padding:8px 12px; font-weight:700; cursor:pointer}
    .btn:hover{background:var(--accent-dark)}

    /* ëŒ“ê¸€ */
    .comments{margin-top:14px; text-align:left}
    .comment{border-top:1px solid #ddd; padding:10px 4px}
    .comment strong{color:#5a4e00}
    .comment-form{margin-top:10px; display:grid; gap:8px}
    .row{display:flex; gap:10px; align-items:center}
    .muted{font-size:12px; color:#888}

    /* íŒì—… */
    .popup{position:fixed; inset:0; background:rgba(0,0,0,.4); display:none; justify-content:center; align-items:center; z-index:1000}
  </style>
</head>
<body>
  <header>
    <h1>ğŸŒ¼ ê¹€ì•„ë¦¬ì˜ ë…¸ë€ í•˜ë£¨</h1>
    <button id="darkToggle" onclick="toggleDark()">ğŸŒ™</button>
    <p>ë”°ëœ»í•œ ë…¸ë€ë¹› ì†ì— í•˜ë£¨ë¥¼ ê¸°ë¡í•´ìš” ğŸ’›</p>
  </header>

  <nav>
    <button onclick="showSection('home')">ğŸ  í™ˆ</button>
    <button onclick="showSection('write')">âœï¸ ê¸€ì“°ê¸°</button>
    <button onclick="showCategory('broadcast')">ğŸ¤ ë°©ì†¡ë¶€</button>
    <button onclick="showCategory('cute')">ğŸ¾ ê·€ì—¬ìš´ ê²ƒë“¤</button>
    <button onclick="showCategory('school')">ğŸ« í•™êµ ìƒí™œ</button>
    <button onclick="showCategory('daily')">ğŸ’­ í•˜ë£¨ ê¸°ë¡</button>
  </nav>

  <main>
    <!-- í™ˆ -->
    <section id="home">
      <div class="home-grid">
        <!-- ì™¼ìª½: ìê¸°ì†Œê°œ -->
        <div class="card">
          <h3>ğŸ± ì•„ë¦¬ì˜ ìê¸°ì†Œê°œ</h3>
          <div class="intro-wrap">
            <img class="intro-img" src="CUTE-CAT.jfif" alt="ì•„ë¦¬ì˜ ê·€ì—¬ìš´ ì‚¬ì§„">
            <div class="intro-text">
              ì•ˆë…•! ë‚˜ëŠ” <b>ì•„ë¦¬</b>ì•¼.<br>
              ë°©ë¬¸í•´ì¤˜ì„œ ê³ ë§ˆì›Œ! ì¬ë°Œê²Œ ë´ì¤˜ ğŸ’›<br><br>
              ì™¼ìª½ ë©”ë‰´ì—ì„œ ê¸€ì“°ê¸°ë„ í•  ìˆ˜ ìˆê³ ,<br>
              ì˜¤ë¥¸ìª½ì—” ë‚´ê°€ ê³ ì •í•œ ê¸€ê³¼ ì‚¬ì§„ ê°¤ëŸ¬ë¦¬ê°€ ìˆì–´!
            </div>
          </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½: ê³ ì • + ê°¤ëŸ¬ë¦¬ -->
        <div class="right-grid">
          <div class="card">
            <h3>ğŸ“Œ ê³ ì •ëœ ê¸€</h3>
            <div id="homePinned" class="pinned-list"></div>
          </div>
          <div class="card">
            <h3>ğŸ“¸ ì‚¬ì§„ ê°¤ëŸ¬ë¦¬</h3>
            <div id="homeGallery" class="gallery"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- ê¸€ì“°ê¸° -->
    <section id="write" style="display:none;">
      <h2>âœï¸ ìƒˆ ê¸€ì“°ê¸°</h2>
      <select id="category">
        <option value="broadcast">ğŸ¤ ë°©ì†¡ë¶€ ì´ì•¼ê¸°</option>
        <option value="cute">ğŸ¾ ê·€ì—¬ìš´ ê²ƒë“¤</option>
        <option value="school">ğŸ« í•™êµ ìƒí™œ</option>
        <option value="daily">ğŸ’­ í•˜ë£¨ ê¸°ë¡</option>
      </select>
      <input id="title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
      <textarea id="content" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>

      <!-- ğŸ“Œ ê¸€ì ì˜† ì²´í¬ë°•ìŠ¤ -->
      <label for="pinPost" style="display:flex; cursor:pointer; font-weight:600; margin:8px 0;">
        ğŸ“Œ ê³ ì •í•˜ê¸°
        <input type="checkbox" id="pinPost" style="cursor:pointer;float:left">
      </label>

      <button class="btn" onclick="openEmojiPopup()">ğŸ˜Š ì´ëª¨í‹°ì½˜</button>
      <input type="file" id="imageInput" accept="image/*">
      <img id="preview" class="preview" alt="">
      <button class="btn" onclick="savePost()">ì €ì¥í•˜ê¸°</button>
    </section>

    <!-- ì¹´í…Œê³ ë¦¬ -->
    <section id="categoryView" style="display:none;">
      <h2 id="categoryTitle"></h2>
      <div class="sort-box">
        <select id="sortSelect" onchange="renderList()">
          <option value="latest">ìµœì‹ ìˆœ</option>
          <option value="oldest">ì˜¤ë˜ëœìˆœ</option>
          <option value="likes">ì¢‹ì•„ìš”ìˆœ</option>
        </select>
      </div>

      <div id="postList"></div>

      <div id="viewPost" style="display:none;">
        <h3 id="viewTitle"></h3>
        <p class="date-text" id="viewDate"></p>
        <p id="viewContent"></p>
        <img id="viewImage" class="preview" alt="">
        <br>
        <button class="like-btn" id="likeBtn" onclick="toggleLike()">â¤ï¸ ì¢‹ì•„ìš” (<span id="likeCount">0</span>)</button>
        <br>
        <button class="btn" onclick="requestEdit()">âœï¸ ìˆ˜ì •</button>
        <button class="btn" onclick="requestDelete()">ğŸ—‘ï¸ ì‚­ì œ</button>
        <button class="btn" onclick="backToList()">ëª©ë¡ìœ¼ë¡œ</button>

        <!-- ğŸ’¬ ëŒ“ê¸€ -->
        <div class="comments">
          <h4>ğŸ’¬ ëŒ“ê¸€</h4>
          <div id="commentList"></div>
          <div class="comment-form">
            <div class="row">
              <input id="commentName" placeholder="ì´ë¦„ (ë¹„ì›Œë„ ë¨)" style="max-width:280px">
              <label><input type="checkbox" id="anonymous"> ìµëª…ìœ¼ë¡œ ì“°ê¸°</label>
            </div>
            <textarea id="commentText" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            <div class="row">
              <button class="btn" onclick="addComment()">ëŒ“ê¸€ ë“±ë¡</button>
              <span class="muted">ì´ë¦„ì„ ë¹„ì›Œë‘ê±°ë‚˜ â€˜ìµëª…ìœ¼ë¡œ ì“°ê¸°â€™ë¥¼ ì²´í¬í•˜ë©´ â€œìµëª…â€ìœ¼ë¡œ ë“±ë¡ë¼ìš”.</span>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- ìˆ˜ì • íŒì—… -->
  <div id="popup" class="popup" style="display:none;">
    <div class="card" style="max-width:520px; width:92%;">
      <h3>âœï¸ ê¸€ ìˆ˜ì •</h3>
      <input id="editTitle">
      <textarea id="editContent"></textarea>
      <label for="editPin" style="display:flex; align-items:center; gap:6px; justify-content:center; cursor:pointer; font-weight:600; margin:8px 0;">
        ğŸ“Œ ê³ ì •í•˜ê¸°
        <input type="checkbox" id="editPin" style="transform:scale(1.15); cursor:pointer;">
      </label>
      <input type="file" id="editImageInput" accept="image/*">
      <img id="editPreview" class="preview" alt="">
      <br>
      <button class="btn" onclick="saveEdit()">ì €ì¥</button>
      <button class="btn" onclick="closePopup()">ë‹«ê¸°</button>
    </div>
  </div>

  <!-- ì´ëª¨í‹°ì½˜ íŒì—… -->
  <div id="emojiPopup" class="popup" style="display:none;">
    <div class="card" style="max-width:520px; width:92%;">
      <h3>ğŸ˜Š ì´ëª¨í‹°ì½˜ ì„ íƒ</h3>
      <div class="emoji-grid" id="emojiGrid" style="display:grid; grid-template-columns:repeat(8,1fr); gap:10px;"></div>
      <br><button class="btn" onclick="closeEmojiPopup()">ë‹«ê¸°</button>
    </div>
  </div>

  <script>
    /* ===== ìŠ¤í† ë¦¬ì§€ í—¬í¼ ===== */
    const CAT_KEYS=['broadcast','cute','school','daily'];
    const sections=['home','write','categoryView'];
    let currentCategory=null, posts=[], currentIndex=null;

    const getKey = cat => 'posts_'+cat;
    const safeParse = (j,f=[]) => { try{const v=JSON.parse(j); return Array.isArray(v)?v:f;}catch{return f;} };
    const getPosts = cat => safeParse(localStorage.getItem(getKey(cat)),[]);
    const setPosts = (cat,arr) => localStorage.setItem(getKey(cat), JSON.stringify(arr||[]));

    function ensureIds(cat){
      const arr=getPosts(cat); let changed=false;
      arr.forEach(p=>{
        if(!p.id){ p.id='p_'+Date.now().toString(36)+Math.random().toString(36).slice(2,8); changed=true; }
        if(typeof p.likeCount!=='number') { p.likeCount = p.likeCount?Number(p.likeCount):0; changed=true; }
        if(typeof p.liked!=='boolean') { p.liked=false; changed=true; }
        if(typeof p.pinned!=='boolean') { p.pinned=!!p.pinned; changed=true; }
        if(!Array.isArray(p.comments)) { p.comments=[]; changed=true; }
      });
      if(changed) setPosts(cat,arr);
      return arr;
    }
    CAT_KEYS.forEach(k=>ensureIds(k));

    /* ===== ë¼ìš°íŒ… ===== */
    function showSection(n){
      sections.forEach(s=>document.getElementById(s).style.display='none');
      document.getElementById(n).style.display='block';
      if(n==='home') renderHome();
    }

    function showCategory(cat){
      showSection('categoryView');
      currentCategory=cat;
      localStorage.setItem('lastCategory',cat);
      document.getElementById('categoryTitle').textContent =
        cat==='broadcast'?'ğŸ¤ ë°©ì†¡ë¶€ ì´ì•¼ê¸°':
        cat==='cute'?'ğŸ¾ ê·€ì—¬ìš´ ê²ƒë“¤':
        cat==='school'?'ğŸ« í•™êµ ìƒí™œ':'ğŸ’­ í•˜ë£¨ ê¸°ë¡';
      posts=ensureIds(cat);
      renderList();
      document.getElementById('postList').style.display='block';
      document.getElementById('viewPost').style.display='none';
    }

    /* ===== í™ˆ ë Œë” ===== */
    function renderHome(){
      renderHomePinned();
      renderHomeGallery();
    }
    function renderHomePinned(){
      const box=document.getElementById('homePinned');
      let all=[]; CAT_KEYS.forEach(c=>ensureIds(c).forEach(p=>all.push({...p,cat:c})));
      const pinned=all.filter(p=>p.pinned).slice(0,3);
      if(!pinned.length){ box.innerHTML='<p>ê³ ì •ëœ ê¸€ì´ ì—†ì–´ìš” ğŸ“Œ</p>'; return; }
      box.innerHTML=pinned.map(p=>`<div class="item" onclick="openById('${p.cat}','${p.id}')">ğŸ“Œ ${p.title} <span style="font-size:12px;color:#888">Â· ${p.date||''}</span></div>`).join('');
    }
    function renderHomeGallery(){
      const wrap=document.getElementById('homeGallery'); wrap.innerHTML='';
      let all=[]; CAT_KEYS.forEach(c=>ensureIds(c).forEach(p=>all.push({...p,cat:c})));
      const withImg=all.filter(p=>p.image);
      if(!withImg.length){ wrap.innerHTML='<p>ì•„ì§ ì‚¬ì§„ì´ ì—†ì–´ìš” ğŸ“·</p>'; return; }
      wrap.innerHTML=withImg.map(p=>`
        <div class="tile" onclick="openById('${p.cat}','${p.id}')">
          <img src="${p.image}" alt="${p.title}">
          <div class="cap">${p.title}</div>
        </div>`).join('');
    }
    function openById(cat,id){
      showCategory(cat);
      const idx=posts.findIndex(p=>p.id===id);
      if(idx>=0) openPost(idx);
    }

    /* ===== ëª©ë¡/ì •ë ¬ ===== */
    function renderList(){
      const sort=document.getElementById('sortSelect').value;
      let arr=[...posts];
      arr.sort((a,b)=>{
        if(sort==='latest') return new Date(b.date)-new Date(a.date);
        if(sort==='oldest') return new Date(a.date)-new Date(b.date);
        if(sort==='likes')  return (b.likeCount||0)-(a.likeCount||0);
        return 0;
      });
      const seq=[...arr.filter(p=>p.pinned), ...arr.filter(p=>!p.pinned)];
      const list=document.getElementById('postList');
      if(!seq.length){ list.innerHTML='<p>ì•„ì§ ê¸€ì´ ì—†ì–´ìš” ğŸ·</p>'; return; }
      list.innerHTML=seq.map(p=>{
        const i=posts.indexOf(p);
        return `<div class="post-item" onclick="openPost(${i})">${p.pinned?'ğŸ“Œ ':''}ğŸ“… ${p.date||''} Â· ${p.title}</div>`;
      }).join('');
    }

    /* ===== ë³´ê¸°/ì¢‹ì•„ìš”/ìˆ˜ì •/ì‚­ì œ ===== */
    function openPost(i){
      currentIndex=i;
      const p=posts[i];
      document.getElementById('viewTitle').textContent=p.title;
      document.getElementById('viewDate').textContent='ì‘ì„±ì¼: '+(p.date||'');
      document.getElementById('viewContent').textContent=p.content||'';
      document.getElementById('viewImage').src=p.image||'';
      document.getElementById('postList').style.display='none';
      document.getElementById('viewPost').style.display='block';
      updateLikeDisplay();
      renderComments();
    }
    function backToList(){
      posts=ensureIds(currentCategory);
      document.getElementById('viewPost').style.display='none';
      document.getElementById('postList').style.display='block';
      renderList();
    }
    function requestDelete(){
      if(!confirm('ì´ ê¸€ì„ ì‚­ì œí• ê¹Œìš”?')) return;
      posts.splice(currentIndex,1);
      setPosts(currentCategory,posts);
      alert('ì‚­ì œ ì™„ë£Œ ğŸ—‘ï¸');
      backToList(); renderHome();
    }
    function requestEdit(){ openEditPopup(); }

    /* ===== ê¸€ì“°ê¸°/ìˆ˜ì • ===== */
    document.getElementById('imageInput').addEventListener('change',function(){
      const f=this.files[0]; if(!f) return;
      const r=new FileReader(); r.onload=e=>document.getElementById('preview').src=e.target.result; r.readAsDataURL(f);
    });
    function savePost(){
      const catEl=document.getElementById('category');
      const cat=(catEl && catEl.value)? String(catEl.value): 'daily';
      const arr=ensureIds(cat);
      const now=new Date();
      const date=now.getFullYear()+'-'+String(now.getMonth()+1).padStart(2,'0')+'-'+String(now.getDate()).padStart(2,'0');
      const newPost={
        id:'p_'+Date.now().toString(36)+Math.random().toString(36).slice(2,8),
        title:(document.getElementById('title').value||'ì œëª© ì—†ìŒ').trim(),
        content:document.getElementById('content').value,
        image:document.getElementById('preview').src||'',
        date, likeCount:0, liked:false,
        pinned:document.getElementById('pinPost').checked,
        comments:[]
      };
      arr.unshift(newPost); setPosts(cat,arr);
      document.getElementById('title').value='';
      document.getElementById('content').value='';
      document.getElementById('preview').src='';
      document.getElementById('imageInput').value='';
      document.getElementById('pinPost').checked=false;
      alert('ì €ì¥ ì™„ë£Œ ğŸ’›');
      showCategory(cat);
      renderHome();
    }
    function openEditPopup(){
      const p=posts[currentIndex];
      document.getElementById('editTitle').value=p.title;
      document.getElementById('editContent').value=p.content;
      document.getElementById('editPin').checked=!!p.pinned;
      document.getElementById('editPreview').src=p.image||'';
      document.getElementById('popup').style.display='flex';
    }
    function closePopup(){ document.getElementById('popup').style.display='none'; }
    document.getElementById('editImageInput').addEventListener('change',function(){
      const f=this.files[0]; if(!f) return;
      const r=new FileReader(); r.onload=e=>document.getElementById('editPreview').src=e.target.result; r.readAsDataURL(f);
    });
    function saveEdit(){
      const t=document.getElementById('editTitle').value.trim();
      const c=document.getElementById('editContent').value.trim();
      const i=document.getElementById('editPreview').src;
      const pin=document.getElementById('editPin').checked;
      const old=posts[currentIndex];
      posts[currentIndex]={...old, title:t||old.title, content:c, image:i, pinned:pin};
      setPosts(currentCategory,posts);
      alert('ìˆ˜ì • ì™„ë£Œ ğŸ’›');
      closePopup();
      openPost(currentIndex);
      renderHome();
    }

    function toggleLike(){
      const p=posts[currentIndex];
      p.liked=!p.liked;
      p.likeCount=(p.likeCount||0)+(p.liked?1:-1);
      if(p.likeCount<0) p.likeCount=0;
      setPosts(currentCategory,posts);
      updateLikeDisplay();
    }
    function updateLikeDisplay(){
      const p=posts[currentIndex];
      document.getElementById('likeCount').textContent=p.likeCount||0;
      document.getElementById('likeBtn').classList.toggle('active',!!p.liked);
    }

    /* ===== ëŒ“ê¸€ ===== */
    function addComment(){
      const nameInput=document.getElementById('commentName').value.trim();
      const text=document.getElementById('commentText').value.trim();
      const isAnon=document.getElementById('anonymous').checked;
      if(!text) return alert("ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”");
      const name = isAnon ? 'ìµëª…' : (nameInput || 'ìµëª…');
      const now = new Date();
      const ts = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
      const p=posts[currentIndex];
      p.comments=p.comments||[];
      p.comments.push({name, content:text, date:ts});
      setPosts(currentCategory,posts);
      document.getElementById('commentName').value='';
      document.getElementById('commentText').value='';
      document.getElementById('anonymous').checked=false;
      renderComments();
    }
    function renderComments(){
      const p=posts[currentIndex];
      const list=document.getElementById('commentList');
      if(!p.comments || !p.comments.length){
        list.innerHTML='<p class="muted">ì•„ì§ ëŒ“ê¸€ì´ ì—†ì–´ìš”. ì²« ëŒ“ê¸€ì˜ ì£¼ì¸ê³µì´ ë˜ì–´ì¤˜! ğŸ’›</p>'; return;
      }
      list.innerHTML=p.comments.map(c=>(
        `<div class="comment"><strong>${c.name}</strong> <span class="muted">${c.date||''}</span><br>${c.content}</div>`
      )).join('');
    }

    /* ===== ì´ëª¨í‹°ì½˜ ===== */
    const emojis="ğŸ˜€ğŸ˜ğŸ˜‚ğŸ¤£ğŸ˜…ğŸ˜ŠğŸ˜‹ğŸ˜ğŸ˜˜ğŸ˜ğŸ˜‡ğŸ¥°ğŸ¤©ğŸ˜œğŸ˜ğŸ™‚ğŸ™ƒğŸ˜‰ğŸ˜ŒğŸ˜´ğŸ˜ªğŸ˜†ğŸ˜®ğŸ˜²ğŸ˜­ğŸ˜¡ğŸ˜ºğŸ˜»ğŸ¶ğŸ±ğŸ·ğŸ°ğŸ»ğŸ¼ğŸ¸ğŸ¥ğŸ€ğŸŒ¸ğŸŒ¼ğŸŒˆğŸğŸ©ğŸ°â˜•ğŸ”ğŸŸğŸ¬ğŸ§ğŸµğŸ’ŒğŸ’–ğŸ’›ğŸ’™ğŸ’œğŸ’¤âœ¨ğŸ”¥ğŸ’§â­ğŸ‰".split("");
    document.getElementById('emojiGrid').innerHTML = emojis.map(e=>`<span style="font-size:24px; cursor:pointer" onclick="insertEmoji('${e}')">${e}</span>`).join('');
    function openEmojiPopup(){document.getElementById('emojiPopup').style.display='flex';}
    function closeEmojiPopup(){document.getElementById('emojiPopup').style.display='none';}
    function insertEmoji(e){
      const c=document.getElementById('content');
      const s=c.selectionStart||c.value.length, d=c.selectionEnd||c.value.length;
      c.value=c.value.slice(0,s)+e+c.value.slice(d);
      c.focus(); c.selectionStart=c.selectionEnd=s+e.length;
      closeEmojiPopup();
    }

    /* ===== ë‹¤í¬ ëª¨ë“œ ===== */
    function toggleDark(){
      document.body.classList.toggle('dark');
      localStorage.setItem('darkMode', document.body.classList.contains('dark'));
    }
    if(localStorage.getItem('darkMode')==='true') document.body.classList.add('dark');

    /* ===== ì‹œì‘ ===== */
    window.addEventListener('load',()=>{
      const last=localStorage.getItem('lastCategory');
      if(last && CAT_KEYS.includes(last)) showCategory(last);
      else showSection('home');
    });
  </script>
</body>
</html>
